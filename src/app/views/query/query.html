<div class="query-bar">

  <!-- alerts -->
  <div class="alerts">
    <div class="alert alert-info alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      Data is subject to our data usage policy found
      <a target="_blank" href="http://diversityindopacific.net/data-usage-agreement/">here</a>
    </div>

    <div ng-repeat="alert in $ctrl.alerts.getAlerts()" class="alert alert-{{alert.level}} alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" ng-click="$ctrl.alerts.remove(alert)" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      {{ alert.msg }}
    </div>
  </div>

  <div class="actions" layout="row" layout-align="end center">
    <!-- query view toggle -->
    <div class="md-dense" layout="row" layout-align="center center">
      <md-button ng-click="$ctrl.toggleMap(true)" ng-disabled="$ctrl.showMap" class="groupX left md-raised">Map</md-button>
      <md-button ng-click="$ctrl.toggleMap(false)" ng-disabled="!$ctrl.showMap" class="groupX right md-raised">Table</md-button>
    </div>

    <!-- download menu -->
    <div ng-show="$ctrl.queryResults.isSet" class="btn-group btn-group-sm download-btn">
      <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">Download
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li>
          <a href="#" ng-click="$ctrl.downloadCsv()">CSV</a>
        </li>
        <li>
          <a href="#" ng-click="$ctrl.downloadKml()">KML</a>
        </li>
        <li>
          <a href="#" ng-click="$ctrl.downloadFasta()">Fasta</a>
        </li>
        <li>
          <a href="#" ng-show="$ctrl.hasFastqData()" ng-click="$ctrl.downloadFastq()">Fastq</a>
        </li>
        <li>
          <a href="#" ng-show="$ctrl.selectedExpeditions.length === 1" ng-click="$ctrl.downloadExcel()">Excel Template
          </a>
        </li>
      </ul>
    </div>
  </div>


</div>

<div layout="row" flex class="query-page">
  <!-- sidebar-->
  <md-sidenav flex="33" class="md-sidenav-left sidebar" md-component-id='left' md-disable-backdrop md-is-locked-open="$ctrl.showSidebar"
    md-whiteframe="4">
    <fims-query-form params="$ctrl.params" on-new-results="$ctrl.handleNewResults(results)" query-map="$ctrl.queryMap"
      class="query-form" current-project="$ctrl.currentProject" expeditions="$ctrl.expeditions" markers="$ctrl.markers"
      filter-options="$ctrl.filterOptions" current-user="$ctrl.currentUser" on-project-change="$ctrl.handleProjectChange(project)"
      toggle-loading="$ctrl.toggleLoading(val)" layout-padding></fims-query-form>
  </md-sidenav>

  <!-- sidebar toggle -->
  <div class="sidebar-toggle">
    <md-button class="md-raised" ng-click="$ctrl.toggleSidebar()">
      <md-tooltip md-direction="right">{{ $ctrl.sidebarToggleToolTip }}</md-tooltip>
      <md-icon md-font-icon="fa {{ ($ctrl.showSidebar) ? 'fa-chevron-left' : 'fa-chevron-right' }}"></md-icon>
    </md-button>
  </div>

  <!-- main content-->
  <div flex layout="column" class="query-content">

    <md-progress-circular ng-show="$ctrl.loading" md-mode="indeterminate"></md-progress-circular>

    <div class="center-spinner" us-spinner="" spinner-key="query-spinner"></div>

    <!-- map -->
    <fims-map ng-show="$ctrl.showMap" flex layout="row" map-instance="$ctrl.queryMap"></fims-map>


    <!-- table -->
    <md-content>
      <fims-query-table ng-show="!$ctrl.showMap" class="query-table" ng-class="{'full-page-query-table': !$ctrl.showSidebar}"
        results="$ctrl.results"></fims-query-table>
    </md-content>

  </div>
</div>
<!-- </div> -->
<!--<h3 class="page-header">Query</h3>-->
<!--<p>Data is subject to our data usage policy found-->
<!--<a target="_blank" href="http://diversityindopacific.net/data-usage-agreement/">here</a></p>-->

<!--<p>Using this tool you can search the GeOMe database. You can filter your results by expedition and on any of the-->
<!--FIMS fields by clicking "More search options". The results of your search can be downloaded as a comma delimited-->
<!--text file (.csv), Google Earth kml file. The Fasta download option will download a zip file containing the Fims-->
<!--Metadata and a fasta files containing any associated fastaSequences in your query results. If you are querying-->
<!--only-->
<!--1 expedition, then you can also download the results as and Excel spreadsheet template (.xlsx).-->

<!--</p>-->
<!--<p>-->
<!--<em>Note:</em> Although you can filter your results on the fastaSequence.marker and/or fastaSequence.sequence-->
<!--fields, those fields will only appear in the results when you click the "Fasta" download option.-->
<!--</p>-->