<form method="POST" name="queryForm" layout="column">

  <project-selector layout="row" layout-align="center" is-authenticated="!!($ctrl.currentUser)" current-project="$ctrl.currentProject"
    on-change="$ctrl.onProjectChange({ project: project })"></project-selector>

  <md-input-container ng-show="$ctrl.currentProject">
    <input type="text" placeholder="Query String..." ng-model="$ctrl.params.queryString" />
    <a class="hint-right text-upper" href="#" ng-click="$ctrl.moreSearchOptions = !$ctrl.moreSearchOptions">
      More search options</a>
  </md-input-container>

  <div ng-show="$ctrl.moreSearchOptions">

    <section>
      <a href="#" ng-click="$ctrl.showMap = !$ctrl.showMap" class="md-subhead bold">Map</a>
      <div class="md-form-group" ng-show="$ctrl.showMap" layout="column" layout-margin>
        <div layout="row" layout-wrap>
          <md-checkbox class="small" ng-model="$ctrl.params.isMappable" name="isMappable"> is Mappable</md-checkbox>
          <md-checkbox class="small" ng-model="$ctrl.params.coordinateUncertaintyInMeters" name="coordinateUncertaintyInMeters">
            has coordinateUncertaintyInMeters</md-checkbox>
          <md-checkbox class="small" ng-model="$ctrl.params.hasPermitInfo" name="hasPermitInfo"> has permitInfo</md-checkbox>
        </div>
        <div layout="row">
          <div flex="25">
            <p class="small bold">BoundingBox: </p>
          </div>

          <div flex layout="row" layout-align="center center" ng-show="$ctrl.params.bounds">
            <div flex="66" layout="column">
              <div>
                <span class="small bold">northEast:</span>
                <span class="small"> [{{$ctrl.params.bounds.northEast.lat | number:2 }}, {{$ctrl.params.bounds.northEast.lng
                  | number:2 }}]</span>
              </div>
              <div>
                <span class="small bold">southWest:</span>
                <span class="small"> [{{$ctrl.params.bounds.southWest.lat | number:2 }}, {{$ctrl.params.bounds.southWest.lng
                  | number:2 }}]</span>
              </div>
            </div>
            <md-button class="md-raised md-warn md-hue-2 md-button-sm" ng-click="$ctrl.clearBounds()">Clear</md-button>
          </div>
          <md-button class="md-raised md-primary md-button-sm" ng-class="{'active': $ctrl.drawing}" ng-show="!$ctrl.params.bounds"
            ng-click="$ctrl.drawBounds()">Draw</md-button>
        </div>
      </div>
    </section>

    <section class="sequences" ng-show="$ctrl.hasFastqEntity || $ctrl.markers">
      <a href="#" ng-click="$ctrl.showSequences = !$ctrl.showSequences" class="md-subhead bold">Sequences</a>
      <div class="md-form-group" ng-show="$ctrl.showSequences" layout="column" layout-margin>
        <div layout="row" ng-show="$ctrl.hasFastqEntity">
          <md-checkbox class="small" ng-model="$ctrl.params.hasSRAAccessions" name="hasSraAccessions"> has NCBI Sequence Read Archive Accession Numbers</md-checkbox>
        </div>
        <div layout="row" ng-show="$ctrl.markers">
          <md-input-container flex="80">
            <label>marker</label>
            <md-select ng-model="$ctrl.params.marker">
              <md-option>-- Select a Sequence Marker --</md-option>
              <md-option ng-value="marker.value" ng-repeat="marker in $ctrl.markers track by marker.value">{{marker.value}}</md-option>
            </md-select>
          </md-input-container>
        </div>
      </div>
    </section>

    <section class="dwc-terms">
      <a href="#" ng-click="$ctrl.showDWC = !$ctrl.showDWC" class="md-subhead bold"> Darwin Core Terms</a>
      <div class="md-form-group" ng-show="$ctrl.showDWC" layout="column" layout-margin>
        <div layout="row">
          <md-input-container flex="50">
            <input ng-model="$ctrl.params.genus" type="text" placeholder="Genus" />
          </md-input-container>
          <md-input-container flex="50">
            <input ng-model="$ctrl.params.country" type="text" placeholder="Country" />
          </md-input-container>
        </div>
        <div layout="row">
          <md-input-container flex="50">
            <input ng-model="$ctrl.params.family" type="text" placeholder="Family" />
          </md-input-container>
          <md-input-container flex="50">
            <input ng-model="$ctrl.params.locality" type="text" placeholder="Locality" />
          </md-input-container>
        </div>
        <div layout="row">
          <md-input-container flex>
            <input ng-model="$ctrl.params.species" type="text" placeholder="Species" />
          </md-input-container>
        </div>
        <div layout="row" layout-align="start center">
          <span flex="30" class="small">yearCollected</span>
          <md-input-container md-no-float flex="15">
            <input ng-model="$ctrl.params.fromYear" type="text" placeholder="YYYY" />
          </md-input-container>
          <span flex="10" class="small" style="text-align: center;">to</span>
          <md-input-container md-no-float flex="15">
            <input ng-model="$ctrl.params.toYear" type="text" placeholder="YYYY" />
          </md-input-container>
        </div>
      </div>
    </section>

    <section class="expeditions">
      <a href="#" ng-click="$ctrl.showExpeditions = !$ctrl.showExpeditions" class="md-subhead bold">Expeditions</a>
      <div class="md-form-group" ng-show="$ctrl.showExpeditions" layout="column" layout-margin>
        <md-chips ng-model="$ctrl.params.expeditions" md-autocomplete-snap md-require-match md-transform-chip="$ctrl.transformChip($chip)">
          <md-autocomplete md-selected-item="$ctrl.selectedItem" md-trim="false" md-search-text="$ctrl.searchText" md-items="item in $ctrl.filterExpeditions($ctrl.searchText)">
            md-item-text="item" placeholder="Expedition Name ...">
            <span md-highlight-text="$ctrl.searchText">{{item}}</span>
          </md-autocomplete>
          <md-chip-template>
            <span>
              <strong>{{$chip}}</strong>
            </span>
          </md-chip-template>
        </md-chips>
      </div>
    </section>

    // TODO: finish me
    <div class="form-group row">
      <div class="column-filters-header clearfix">
        <div class="col-xs-4">
          <a href="#" ng-click="$ctrl.showFilters = !$ctrl.showFilters">
            <label class="control-label">Column Filters</label>
          </a>
        </div>
        <div class="col-xs-4">
          <button type="button" class="center-block btn btn-default btn-xs" ng-show="$ctrl.showFilters" ng-click="$ctrl.addFilter()">
            <span class="glyphicon glyphicon-plus small"></span> Add Filter
          </button>
        </div>
        <div class="col-xs-4"></div>
      </div>

      <div class="col-xs-12 filters column-filter" ng-show="$ctrl.showFilters" ng-repeat="filter in $ctrl.params.filters track by $index">
        <div class="col-xs-5">
          <ui-select ng-model="filter.field" refresh="$ctrl.params.filters[$index].value=null && $ctrl.params.filters[$index].type=EQUALS">
            <ui-select-match>{{$select.selected.displayName}}</ui-select-match>
            <ui-select-choices repeat="f.displayName as f in ($ctrl.filterOptions | filter: {displayName: $select.search} | filter: {group: '!hidden'}) track by $index"
              position="up" group-by="'group'">
              <div ng-bind-html="f.displayName | highlight: $select.search | trusted_html"></div>
            </ui-select-choices>
          </ui-select>
          <!--<select ng-model="filter.field"-->
          <!--ng-change="$ctrl.params.filters[$index].value=null && $ctrl.params.filters[$index].type=EQUALS"-->
          <!--ng-options="f.field as f.displayName for f in ::$ctrl.filterOptions"-->
          <!--class="form-control input-sm"-->
          <!--&gt;</select>-->
        </div>
        <div class="col-xs-2 filter-query-select">
          <select ng-model="filter.type" class="form-control input-sm" ng-options="type as (type | queryTypeDisplay) for type in $ctrl.getTypes($index)"></select>
        </div>
        <div class="col-xs-5">
          <div ng-show="filter.type != 'EXISTS'">
            <input ng-show="!$ctrl.getList($index)" type="text" class="form-control input-sm" ng-model="filter.value"
            />

            <select ng-show="$ctrl.getList($index)" class="form-control input-sm" ng-options="field for field in $ctrl.getList($index)"
              ng-model="filter.value">
              <option value="">-- Choose value --</option>
            </select>
          </div>
        </div>
        <button type="button" class="btn btn-danger btn-xs filter-remove-btn" ng-click="$ctrl.removeFilter($index)">
          <span class="fa fa-remove"></span>
        </button>
      </div>
    </div>
  </div>

  <div layout="row" layout-align="end center">
    <md-button type="submit" ng-click="$ctrl.currentProject ? $ctrl.queryJson() : '';" class="md-raised">
      <md-tooltip ng-show="!$ctrl.currentProject" md-direction="top">Select a project</md-tooltip>
      <span class="fa fa-search"></span> Search
    </md-button>
  </div>
  <!-- <div class="form-group"> -->
  <!-- <button type="submit" ng-click="$ctrl.queryJson()" class="btn pull-right btn-primary"> -->
  <!-- </button> -->
  </div>
</form>